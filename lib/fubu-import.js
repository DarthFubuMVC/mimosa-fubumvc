"use strict";
var Rx, cleanAssets, color, cwd, excludeStrategies, findSourceFiles, fs, importAssets, isExcludedByConfig, log, logger, parseString, parseXml, path, prepareFileWatcher, shouldInclude, startCopying, watch, withoutFromPath, wrench, _;

log = require('./util').log;

color = require('ansi-color').set;

fs = require('fs');

path = require('path');

watch = require('chokidar');

wrench = require('wrench');

logger = require('logmimosa');

_ = require('lodash');

parseString = require('xml2js').parseString;

cwd = process.cwd();

Rx = require("rx");

findSourceFiles = function(from, extensions, excludes) {
  return wrench.readdirSyncRecursive(from).filter(function(f) {
    var isFile, isIncluded;
    isFile = fs.statSync(f).isFile();
    isIncluded = shouldInclude(f, isFile, extensions, excludes);
    return isIncluded && isFile;
  });
};

shouldInclude = function(f, isFile, extensions, excludes) {
  var atRoot, excluded, ext, matchesExtension;
  extensions = extensions.map(function(ext) {
    return "." + ext;
  });
  ext = path.extname(f);
  matchesExtension = !isFile || _.contains(extensions, ext);
  atRoot = isFile && f.indexOf(path.sep) === -1;
  excluded = isExcludedByConfig(f, excludes);
  return matchesExtension && !excluded && !atRoot;
};

withoutFromPath = function(fromPath) {
  return function(input) {
    return input.replace("" + fromPath + path.sep, '');
  };
};

prepareFileWatcher = function(from, extensions, excludes, isBuild) {
  var adds, changes, errors, files, fixPath, numberOfFiles, observableFor, unlinks, watchSettings, watcher;
  files = findSourceFiles(from, extensions, excludes);
  numberOfFiles = files.length;
  fixPath = withoutFromPath(from);
  watchSettings = {
    ignored: function(file) {
      var f, isFile;
      isFile = fs.statSync(file).isFile();
      f = fixPath(file);
      return !(shouldInclude(f, isFile, extensions, excludes));
    },
    pesistent: !isBuild,
    usePolling: true,
    interval: 500,
    binaryInterval: 1000
  };
  observableFor = function(event) {
    return Rx.Observable.fromEvent(watcher, event);
  };
  watcher = watch.watch(from, watchSettings);
  adds = observableFor("add");
  changes = observableFor("change");
  unlinks = observableFor("unlink");
  errors = (observableFor("error")).selectMany(function(e) {
    return Rx.Observable.Throw(e);
  });
  return {
    numberOfFiles: numberOfFiles,
    adds: adds,
    changes: changes,
    unlinks: unlinks,
    errors: errors
  };
};

startCopying = function(from, extensions, excludes, isBuild, cb) {
  var adds, changes, deletes, errors, fixPath, fromSource, initialCopy, logError, logSuccess, numberOfFiles, unlinks, _ref;
  log("debug", "starting copy from [[ " + from + " ]]");
  log("debug", "allowed extensions [[ " + extensions + " ]]");
  log("debug", "excludes [[ " + excludes + " ]]");
  _ref = prepareFileWatcher(from, extensions, excludes, isBuild), numberOfFiles = _ref.numberOfFiles, adds = _ref.adds, changes = _ref.changes, unlinks = _ref.unlinks, errors = _ref.errors;
  fixPath = withoutFromPath(from);
  fromSource = function(obs) {
    return obs.merge(errors).map(fixPath);
  };
  initialCopy = fromSource(adds).take(numberOfFiles);
  logSuccess = function(f) {
    return log("success", "" + (color("copy", "green")) + " [[ " + f + " ]]");
  };
  logError = function(e) {
    return log("error", "error copying [[ " + e + " ]]");
  };
  initialCopy.subscribe(function(f) {
    return logSuccess(f);
  }, function(e) {
    logError(e);
    if (cb) {
      return cb();
    }
  }, function() {
    var ongoingCopy;
    ongoingCopy = fromSource(adds.merge(changes));
    ongoingCopy.subscribe(function(f) {
      return logSuccess(f);
    }, function(e) {
      return logError(e);
    });
    if (cb) {
      return cb();
    }
  });
  deletes = fromSource(unlinks);
  return deletes.subscribe(function(f) {
    return log("success", "" + (color("deleting", "red")) + " [[ " + f + " ]]");
  }, function(e) {
    return log("error", "error deleting [[ " + e + " ]]");
  });
};

excludeStrategies = {
  string: {
    identity: _.isString,
    predicate: function(ex, path) {
      return path.indexOf(ex) === 0;
    }
  },
  regex: {
    identity: _.isRegExp,
    predicate: function(ex, path) {
      return ex.test(path);
    }
  }
};

isExcludedByConfig = function(path, excludes) {
  var ofType;
  ofType = function(method) {
    return excludes.filter(function(f) {
      return method(f);
    });
  };
  return _.any(excludeStrategies, function(_arg) {
    var identity, predicate;
    identity = _arg.identity, predicate = _arg.predicate;
    return _.any(ofType(identity), function(ex) {
      return predicate(ex, path);
    });
  });
};

parseXml = function(filePath) {
  var contents, result;
  contents = fs.readFileSync(filePath);
  result = {};
  parseString(contents, function(err, output) {
    return result = output;
  });
  return result;
};

importAssets = function(mimosaConfig, options, next) {
  var excludes, extensions, isBuild;
  extensions = mimosaConfig.extensions.copy;
  excludes = mimosaConfig.fubumvc.excludePaths;
  isBuild = mimosaConfig.isBuild;
  return startCopying(cwd, extensions, excludes, isBuild, next);
};

cleanAssets = function(mimosaConfig, options, next) {
  return next();
};

module.exports = {
  importAssets: importAssets,
  cleanAssets: cleanAssets
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYzpcXGhvbWVcXGdpdGh1YlxcbWltb3NhLWZ1YnVtdmNcXGxpYlxcZnVidS1pbXBvcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjOlxcaG9tZVxcZ2l0aHViXFxtaW1vc2EtZnVidW12Y1xcc3JjXFxmdWJ1LWltcG9ydC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBQSxDQUFBO0FBQUEsSUFBQSxtT0FBQTs7QUFBQSxNQUVRLE9BQUEsQ0FBUSxRQUFSLEVBQVAsR0FGRCxDQUFBOztBQUFBLEtBR0EsR0FBUSxPQUFBLENBQVEsWUFBUixDQUFxQixDQUFDLEdBSDlCLENBQUE7O0FBQUEsRUFJQSxHQUFLLE9BQUEsQ0FBUSxJQUFSLENBSkwsQ0FBQTs7QUFBQSxJQUtBLEdBQU8sT0FBQSxDQUFRLE1BQVIsQ0FMUCxDQUFBOztBQUFBLEtBTUEsR0FBUSxPQUFBLENBQVEsVUFBUixDQU5SLENBQUE7O0FBQUEsTUFPQSxHQUFTLE9BQUEsQ0FBUSxRQUFSLENBUFQsQ0FBQTs7QUFBQSxNQVFBLEdBQVMsT0FBQSxDQUFRLFdBQVIsQ0FSVCxDQUFBOztBQUFBLENBU0EsR0FBSSxPQUFBLENBQVEsUUFBUixDQVRKLENBQUE7O0FBQUEsV0FVQSxHQUFjLE9BQUEsQ0FBUSxRQUFSLENBQWlCLENBQUMsV0FWaEMsQ0FBQTs7QUFBQSxHQVdBLEdBQU0sT0FBTyxDQUFDLEdBQVIsQ0FBQSxDQVhOLENBQUE7O0FBQUEsRUFZQSxHQUFLLE9BQUEsQ0FBUSxJQUFSLENBWkwsQ0FBQTs7QUFBQSxlQWNBLEdBQWtCLFNBQUMsSUFBRCxFQUFPLFVBQVAsRUFBbUIsUUFBbkIsR0FBQTtTQUNoQixNQUFNLENBQUMsb0JBQVAsQ0FBNEIsSUFBNUIsQ0FDRSxDQUFDLE1BREgsQ0FDVSxTQUFDLENBQUQsR0FBQTtBQUNOLFFBQUEsa0JBQUE7QUFBQSxJQUFBLE1BQUEsR0FBUyxFQUFFLENBQUMsUUFBSCxDQUFZLENBQVosQ0FBYyxDQUFDLE1BQWYsQ0FB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ZjtDQTlJakIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiXHJcblxyXG57bG9nfSA9IHJlcXVpcmUgJy4vdXRpbCdcclxuY29sb3IgPSByZXF1aXJlKCdhbnNpLWNvbG9yJykuc2V0XHJcbmZzID0gcmVxdWlyZSAnZnMnXHJcbnBhdGggPSByZXF1aXJlICdwYXRoJ1xyXG53YXRjaCA9IHJlcXVpcmUgJ2Nob2tpZGFyJ1xyXG53cmVuY2ggPSByZXF1aXJlICd3cmVuY2gnXHJcbmxvZ2dlciA9IHJlcXVpcmUgJ2xvZ21pbW9zYSdcclxuXyA9IHJlcXVpcmUgJ2xvZGFzaCdcclxucGFyc2VTdHJpbmcgPSByZXF1aXJlKCd4bWwyanMnKS5wYXJzZVN0cmluZ1xyXG5jd2QgPSBwcm9jZXNzLmN3ZCgpXHJcblJ4ID0gcmVxdWlyZSBcInJ4XCJcclxuXHJcbmZpbmRTb3VyY2VGaWxlcyA9IChmcm9tLCBleHRlbnNpb25zLCBleGNsdWRlcykgLT5cclxuICB3cmVuY2gucmVhZGRpclN5bmNSZWN1cnNpdmUoZnJvbSlcclxuICAgIC5maWx0ZXIgKGYpIC0+XHJcbiAgICAgIGlzRmlsZSA9IGZzLnN0YXRTeW5jKGYpLmlzRmlsZSgpXHJcbiAgICAgIGlzSW5jbHVkZWQgPSBzaG91bGRJbmNsdWRlIGYsIGlzRmlsZSwgZXh0ZW5zaW9ucywgZXhjbHVkZXNcclxuICAgICAgaXNJbmNsdWRlZCBhbmQgaXNGaWxlXHJcblxyXG5zaG91bGRJbmNsdWRlID0gKGYsIGlzRmlsZSwgZXh0ZW5zaW9ucywgZXhjbHVkZXMpIC0+XHJcbiAgI1RPRE86IG9ubHkgYWRkcyB0aGUgLiB0byB5b3UgZm9yIGV4dGVuc2lvbnMgaWYgaXRzIGxlZnQgb2ZmXHJcbiAgZXh0ZW5zaW9ucyA9IGV4dGVuc2lvbnMubWFwIChleHQpIC0+IFwiLiN7ZXh0fVwiXHJcbiAgZXh0ID0gcGF0aC5leHRuYW1lIGZcclxuICBtYXRjaGVzRXh0ZW5zaW9uID0gbm90IGlzRmlsZSBvciBfLmNvbnRhaW5zIGV4dGVuc2lvbnMsIGV4dFxyXG4gIGF0Um9vdCA9IGlzRmlsZSBhbmQgZi5pbmRleE9mKHBhdGguc2VwKSA9PSAtMVxyXG4gIGV4Y2x1ZGVkID0gaXNFeGNsdWRlZEJ5Q29uZmlnIGYsIGV4Y2x1ZGVzXHJcbiAgbWF0Y2hlc0V4dGVuc2lvbiBhbmQgbm90IGV4Y2x1ZGVkIGFuZCBub3QgYXRSb290XHJcblxyXG53aXRob3V0RnJvbVBhdGggPSAoZnJvbVBhdGgpIC0+XHJcbiAgKGlucHV0KSAtPiBpbnB1dC5yZXBsYWNlIFwiI3tmcm9tUGF0aH0je3BhdGguc2VwfVwiLCAnJ1xyXG5cclxucHJlcGFyZUZpbGVXYXRjaGVyID0gKGZyb20sIGV4dGVuc2lvbnMsIGV4Y2x1ZGVzLCBpc0J1aWxkKSAtPlxyXG4gICNUT0RPOiBubyBtb3JlIHN5bmMgY2FsbHNcclxuICBmaWxlcyAgPSBmaW5kU291cmNlRmlsZXMgZnJvbSwgZXh0ZW5zaW9ucywgZXhjbHVkZXNcclxuICBudW1iZXJPZkZpbGVzICA9IGZpbGVzLmxlbmd0aFxyXG4gIGZpeFBhdGggPSB3aXRob3V0RnJvbVBhdGggZnJvbVxyXG5cclxuICB3YXRjaFNldHRpbmdzID1cclxuICAgIGlnbm9yZWQ6IChmaWxlKSAtPlxyXG4gICAgICBpc0ZpbGUgPSBmcy5zdGF0U3luYyhmaWxlKS5pc0ZpbGUoKVxyXG4gICAgICBmID0gZml4UGF0aCBmaWxlXHJcbiAgICAgIG5vdCAoc2hvdWxkSW5jbHVkZSBmLCBpc0ZpbGUsIGV4dGVuc2lvbnMsIGV4Y2x1ZGVzKVxyXG4gICAgcGVzaXN0ZW50OiBub3QgaXNCdWlsZFxyXG4gICAgdXNlUG9sbGluZzogdHJ1ZVxyXG4gICAgaW50ZXJ2YWw6IDUwMFxyXG4gICAgYmluYXJ5SW50ZXJ2YWw6IDEwMDBcclxuXHJcbiAgb2JzZXJ2YWJsZUZvciA9IChldmVudCkgLT5cclxuICAgIFJ4Lk9ic2VydmFibGUuZnJvbUV2ZW50IHdhdGNoZXIsIGV2ZW50XHJcblxyXG4gIHdhdGNoZXIgPSB3YXRjaC53YXRjaCBmcm9tLCB3YXRjaFNldHRpbmdzXHJcbiAgYWRkcyA9IG9ic2VydmFibGVGb3IgXCJhZGRcIlxyXG4gIGNoYW5nZXMgPSBvYnNlcnZhYmxlRm9yIFwiY2hhbmdlXCJcclxuICB1bmxpbmtzID0gb2JzZXJ2YWJsZUZvciBcInVubGlua1wiXHJcbiAgZXJyb3JzID0gKG9ic2VydmFibGVGb3IgXCJlcnJvclwiKS5zZWxlY3RNYW55IChlKSAtPiBSeC5PYnNlcnZhYmxlLlRocm93IGVcclxuICB7bnVtYmVyT2ZGaWxlcywgYWRkcywgY2hhbmdlcywgdW5saW5rcywgZXJyb3JzfVxyXG5cclxuc3RhcnRDb3B5aW5nID0gKGZyb20sIGV4dGVuc2lvbnMsIGV4Y2x1ZGVzLCBpc0J1aWxkLCBjYikgLT5cclxuICBsb2cgXCJkZWJ1Z1wiLCBcInN0YXJ0aW5nIGNvcHkgZnJvbSBbWyAje2Zyb219IF1dXCJcclxuICBsb2cgXCJkZWJ1Z1wiLCBcImFsbG93ZWQgZXh0ZW5zaW9ucyBbWyAje2V4dGVuc2lvbnN9IF1dXCJcclxuICBsb2cgXCJkZWJ1Z1wiLCBcImV4Y2x1ZGVzIFtbICN7ZXhjbHVkZXN9IF1dXCJcclxuXHJcbiAge251bWJlck9mRmlsZXMsIGFkZHMsIGNoYW5nZXMsIHVubGlua3MsIGVycm9yc30gPVxyXG4gICAgcHJlcGFyZUZpbGVXYXRjaGVyIGZyb20sIGV4dGVuc2lvbnMsIGV4Y2x1ZGVzLCBpc0J1aWxkXHJcblxyXG4gIGZpeFBhdGggPSB3aXRob3V0RnJvbVBhdGggZnJvbVxyXG5cclxuICBmcm9tU291cmNlID0gKG9icykgLT5cclxuICAgIG9icy5tZXJnZShlcnJvcnMpLm1hcCBmaXhQYXRoXHJcblxyXG4gIGluaXRpYWxDb3B5ID0gZnJvbVNvdXJjZShhZGRzKVxyXG4gICAgLnRha2UobnVtYmVyT2ZGaWxlcylcclxuXHJcbiAgbG9nU3VjY2VzcyA9IChmKSAtPlxyXG4gICAgICBsb2cgXCJzdWNjZXNzXCIsIFwiI3tjb2xvcihcImNvcHlcIiwgXCJncmVlblwiKX0gW1sgI3tmfSBdXVwiXHJcbiAgbG9nRXJyb3IgPSAoZSkgLT5cclxuICAgICAgbG9nIFwiZXJyb3JcIiwgXCJlcnJvciBjb3B5aW5nIFtbICN7ZX0gXV1cIlxyXG5cclxuICBpbml0aWFsQ29weS5zdWJzY3JpYmUoXHJcbiAgICAoZikgLT5cclxuICAgICAgbG9nU3VjY2VzcyBmXHJcbiAgICAoZSkgLT5cclxuICAgICAgbG9nRXJyb3IgZVxyXG4gICAgICBjYigpIGlmIGNiXHJcbiAgICAoKSAtPlxyXG4gICAgICBvbmdvaW5nQ29weSA9IGZyb21Tb3VyY2UoYWRkcy5tZXJnZSBjaGFuZ2VzKVxyXG4gICAgICBvbmdvaW5nQ29weS5zdWJzY3JpYmUoXHJcbiAgICAgICAgKGYpIC0+XHJcbiAgICAgICAgICBsb2dTdWNjZXNzIGZcclxuICAgICAgICAoZSkgLT5cclxuICAgICAgICAgIGxvZ0Vycm9yIGVcclxuICAgICAgKVxyXG4gICAgICBjYigpIGlmIGNiXHJcbiAgKVxyXG5cclxuICBkZWxldGVzID0gZnJvbVNvdXJjZSh1bmxpbmtzKVxyXG5cclxuICBkZWxldGVzLnN1YnNjcmliZShcclxuICAgIChmKSAtPlxyXG4gICAgICBsb2cgXCJzdWNjZXNzXCIsIFwiI3tjb2xvcihcImRlbGV0aW5nXCIsIFwicmVkXCIpfSBbWyAje2Z9IF1dXCJcclxuICAgIChlKSAtPlxyXG4gICAgICBsb2cgXCJlcnJvclwiLCBcImVycm9yIGRlbGV0aW5nIFtbICN7ZX0gXV1cIlxyXG4gIClcclxuXHJcbmV4Y2x1ZGVTdHJhdGVnaWVzID1cclxuICBzdHJpbmc6XHJcbiAgICBpZGVudGl0eTogXy5pc1N0cmluZ1xyXG4gICAgcHJlZGljYXRlOiAoZXgsIHBhdGgpIC0+IHBhdGguaW5kZXhPZihleCkgPT0gMFxyXG4gIHJlZ2V4OlxyXG4gICAgaWRlbnRpdHk6IF8uaXNSZWdFeHBcclxuICAgIHByZWRpY2F0ZTogKGV4LCBwYXRoKSAtPiBleC50ZXN0IHBhdGhcclxuXHJcbmlzRXhjbHVkZWRCeUNvbmZpZyA9IChwYXRoLCBleGNsdWRlcykgLT5cclxuICBvZlR5cGUgPSAobWV0aG9kKSAtPlxyXG4gICAgZXhjbHVkZXMuZmlsdGVyIChmKSAtPiBtZXRob2QoZilcclxuXHJcbiAgXy5hbnkgZXhjbHVkZVN0cmF0ZWdpZXMsICh7aWRlbnRpdHksIHByZWRpY2F0ZX0pIC0+XHJcbiAgICBfLmFueSAob2ZUeXBlIGlkZW50aXR5KSwgKGV4KSAtPiBwcmVkaWNhdGUgZXgsIHBhdGhcclxuXHJcbnBhcnNlWG1sID0gKGZpbGVQYXRoKSAtPlxyXG4gIGNvbnRlbnRzID0gZnMucmVhZEZpbGVTeW5jIGZpbGVQYXRoXHJcbiAgcmVzdWx0ID0ge31cclxuICBwYXJzZVN0cmluZyBjb250ZW50cywgKGVyciwgb3V0cHV0KSAtPlxyXG4gICAgcmVzdWx0ID0gb3V0cHV0XHJcbiAgcmVzdWx0XHJcblxyXG5pbXBvcnRBc3NldHMgPSAobWltb3NhQ29uZmlnLCBvcHRpb25zLCBuZXh0KSAtPlxyXG4gICNUT0RPOiBpbmNsdWRlIHNlbnNpYmxlIGRlZmF1bHQgZXh0ZW5zaW9ucyAoLmNvZmZlZSwgZXRjKSBwdWxsIGZyb20gY29uZmlnIHNvbWVob3c/XHJcbiAgZXh0ZW5zaW9ucyA9IG1pbW9zYUNvbmZpZy5leHRlbnNpb25zLmNvcHlcclxuICBleGNsdWRlcyA9IG1pbW9zYUNvbmZpZy5mdWJ1bXZjLmV4Y2x1ZGVQYXRoc1xyXG4gIGlzQnVpbGQgPSBtaW1vc2FDb25maWcuaXNCdWlsZFxyXG4gIHN0YXJ0Q29weWluZyBjd2QsIGV4dGVuc2lvbnMsIGV4Y2x1ZGVzLCBpc0J1aWxkLCBuZXh0XHJcbiAgI1RPRE86IGdhdGhlciBzb3VyY2VzXHJcbiAgIy5saW5rcywgd2lsbCB1c2UgcGFyc2VYbWwgZm9yIHRoaXNcclxuICAjZnVidS1jb250ZW50XHJcbiAgI3NvdXJjZSBkaXIgKGluY2x1ZGluZyBjb250ZW50KVxyXG5cclxuY2xlYW5Bc3NldHMgPSAobWltb3NhQ29uZmlnLCBvcHRpb25zLCBuZXh0KSAtPlxyXG4gIG5leHQoKVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7aW1wb3J0QXNzZXRzLCBjbGVhbkFzc2V0c31cclxuIl19
