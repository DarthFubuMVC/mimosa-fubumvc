"use strict";
var Bliss, bliss, cleanAssets, copyContents, cwd, findSourceFiles, fs, importAssets, initFiles, logger, makeFolders, makeOptions, mkdirp, parseString, parseXml, path, relativeToThisFile, setupFileSystem, watch, wrench, _;

fs = require('fs');

path = require('path');

watch = require('chokidar');

wrench = require('wrench');

logger = require('logmimosa');

_ = require('lodash');

mkdirp = require('mkdirp');

parseString = require('xml2js').parseString;

Bliss = require('bliss');

bliss = new Bliss({
  ext: ".bliss",
  cacheEnabled: false,
  context: {}
});

cwd = process.cwd();

importAssets = function(mimosaConfig, options, next) {
  var extensions, sourceFiles;
  extensions = mimosaConfig.extensions.copy;
  sourceFiles = findSourceFiles(extensions);
  logger.info(sourceFiles);
  return next();
};

cleanAssets = function(mimosaConfig, options, next) {
  return next();
};

findSourceFiles = function(extensions) {
  extensions = extensions.map(function(ext) {
    return "." + ext;
  });
  return wrench.readdirSyncRecursive(cwd).filter(function(f) {
    var isFile, matchesExtension;
    matchesExtension = _.contains(extensions, path.extname(f));
    isFile = fs.statSync(f).isFile();
    return matchesExtension && isFile;
  });
};

relativeToThisFile = function(filePath, dirname) {
  if (dirname == null) {
    dirname = __dirname;
  }
  return path.join(dirname, filePath);
};

setupFileSystem = function(args) {
  makeFolders();
  return initFiles(args);
};

makeFolders = function() {
  var folders;
  folders = ['assets/scripts', 'assets/styles', 'public'];
  return _.each(folders, function(dir) {
    logger.info("making sure " + dir + " exists");
    return mkdirp.sync(dir, function(err) {
      return logger.error(err);
    });
  });
};

makeOptions = function() {
  var options;
  return options = {
    name: path.basename(cwd)
  };
};

initFiles = function(flags) {
  var contents, ext, fileWithContents, files, options, pair, useCoffee, _i, _len, _results;
  if (flags == null) {
    flags = false;
  }
  useCoffee = flags === "coffee";
  options = makeOptions();
  ext = useCoffee ? "coffee" : "js";
  files = ["bower.json", "mimosa-config." + ext];
  contents = _(files).map(function(f) {
    return relativeToThisFile("../fubu-import-templates/" + f);
  }).map(function(f) {
    return bliss.render(f, options);
  }).map(function(f) {
    return f.trim();
  }).value();
  fileWithContents = _.zip(files, contents);
  _results = [];
  for (_i = 0, _len = fileWithContents.length; _i < _len; _i++) {
    pair = fileWithContents[_i];
    _results.push(copyContents(pair));
  }
  return _results;
};

copyContents = function(pair) {
  var contents, fileName;
  fileName = pair[0], contents = pair[1];
  if (!fs.existsSync(fileName)) {
    logger.info("creating " + fileName);
    return fs.writeFileSync(fileName, contents);
  }
};

parseXml = function(filePath) {
  var contents, result;
  contents = fs.readFileSync(filePath);
  result = {};
  parseString(contents, function(err, output) {
    return result = output;
  });
  return result;
};

module.exports = {
  importAssets: importAssets,
  cleanAssets: cleanAssets,
  setupFileSystem: setupFileSystem
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYzpcXGhvbWVcXGdpdGh1YlxcbWltb3NhLWZ1YnVtdmNcXGxpYlxcZnVidS1pbXBvcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjOlxcaG9tZVxcZ2l0aHViXFxtaW1vc2EtZnVidW12Y1xcc3JjXFxmdWJ1LWltcG9ydC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBQSxDQUFBO0FBQUEsSUFBQSx3TkFBQTs7QUFBQSxFQUVBLEdBQUssT0FBQSxDQUFRLElBQVIsQ0FGTCxDQUFBOztBQUFBLElBR0EsR0FBTyxPQUFBLENBQVEsTUFBUixDQUhQLENBQUE7O0FBQUEsS0FJQSxHQUFRLE9BQUEsQ0FBUSxVQUFSLENBSlIsQ0FBQTs7QUFBQSxNQUtBLEdBQVMsT0FBQSxDQUFRLFFBQVIsQ0FMVCxDQUFBOztBQUFBLE1BTUEsR0FBUyxPQUFBLENBQVEsV0FBUixDQU5ULENBQUE7O0FBQUEsQ0FPQSxHQUFJLE9BQUEsQ0FBUSxRQUFSLENBUEosQ0FBQTs7QUFBQSxNQVFBLEdBQVMsT0FBQSxDQUFRLFFBQVIsQ0FSVCxDQUFBOztBQUFBLFdBU0EsR0FBYyxPQUFBLENBQVEsUUFBUixDQUFpQixDQUFDLFdBVGhDLENBQUE7O0FBQUEsS0FVQSxHQUFRLE9BQUEsQ0FBUSxPQUFSLENBVlIsQ0FBQTs7QUFBQSxLQVdBLEdBQVksSUFBQSxLQUFBLENBQ1Y7QUFBQSxFQUFBLEdBQUEsRUFBSyxRQUFMO0FBQUEsRUFDQSxZQUFBLEVBQWMsS0FEZDtBQUFBLEVBRUEsT0FBQSxFQUFTLEVBRlQ7Q0FEVSxDQVhaLENBQUE7O0FBQUEsR0FlQSxHQUFNLE9BQU8sQ0FBQyxHQUFSLENBQUEsQ0FmTixDQUFBOztBQUFBLFlBaUJBLEdBQWUsU0FBQyxZQUFELEVBQWUsT0FBZixFQUF3QixJQUF4QixHQUFBO0FBQ2IsTUFBQSx1QkFBQTtBQUFBLEVBQUEsVUFBQSxHQUFhLFlBQVksQ0FBQyxVQUFVLENBQUMsSUFBckMsQ0FBQTtBQUFBLEVBQ0EsV0FBQSxHQUFjLGVBQUEsQ0FBZ0IsVUFBaEIsQ0FEZCxDQUFBO0FBQUEsRUFFQSxNQUFNLENBQUMsSUFBUCxDQUFZLFdBQVosQ0FGQSxDQUFBO1NBT0EsSUFBQSxDQUFBLEVBUmE7QUFBQSxDQWpCZixDQUFBOztBQUFBLFdBMkJBLEdBQWMsU0FBQyxZQUFELEVBQWUsT0FBZixFQUF3QixJQUF4QixHQUFBO1NBQ1osSUFBQSxDQUFBLEVBRFk7QUFBQSxDQTNCZCxDQUFBOztBQUFBLGVBOEJBLEdBQWtCLFNBQUMsVUFBRCxHQUFBO0FBQ2hCLEVBQUEsVUFBQSxHQUFhLFVBQVUsQ0FBQyxHQUFYLENBQWUsU0FBQyxHQUFELEdBQUE7V0FBVSxHQUFBLEdBQUUsSUFBWjtFQUFBLENBQWYsQ0FBYixDQUFBO1NBQ0EsTUFBTSxDQUFDLG9CQUFQLENBQTRCLEdBQTVCLENBQ0UsQ0FBQyxNQURILENBQ1UsU0FBQyxDQUFELEdBQUE7QUFDTixRQUFBLHdCQUFBO0FBQUEsSUFBQSxnQkFBQSxHQUFtQixDQUFDLENBQUMsUUFBRixDQUFXLFVBQVgsRUFBdUIsSUFBSSxDQUFDLE9BQUwsQ0FBYSxDQUFiLENBQXZCLENBQW5CLENBQUE7QUFBQSxJQUNBLE1BQUEsR0FBUyxFQUFFLENBQUMsUUFBSCxDQUFZLENBQVosQ0FBYyxDQUFDLE1BQWYsQ0FBQSxDQURULENBQUE7V0FFQSxnQkFBQSxJQUFxQixPQUhmO0VBQUEsQ0FEVixFQUZnQjtBQUFBLENBOUJsQixDQUFBOztBQUFBLGtCQXNDQSxHQUFxQixTQUFDLFFBQUQsRUFBVyxPQUFYLEdBQUE7O0lBQ25CLFVBQVc7R0FBWDtTQUNBLElBQUksQ0FBQyxJQUFMLENBQVUsT0FBVixFQUFtQixRQUFuQixFQUZtQjtBQUFBLENBdENyQixDQUFBOztBQUFBLGVBMENBLEdBQWtCLFNBQUMsSUFBRCxHQUFBO0FBQ2hCLEVBQUEsV0FBQSxDQUFBLENBQUEsQ0FBQTtTQUNBLFNBQUEsQ0FBVSxJQUFWLEVBRmdCO0FBQUEsQ0ExQ2xCLENBQUE7O0FBQUEsV0E4Q0EsR0FBYyxTQUFBLEdBQUE7QUFFWixNQUFBLE9BQUE7QUFBQSxFQUFBLE9BQUEsR0FBVSxDQUFDLGdCQUFELEVBQW1CLGVBQW5CLEVBQW9DLFFBQXBDLENBQVYsQ0FBQTtTQUNBLENBQUMsQ0FBQyxJQUFGLENBQU8sT0FBUCxFQUFnQixTQUFDLEdBQUQsR0FBQTtBQUNkLElBQUEsTUFBTSxDQUFDLElBQVAsQ0FBYSxjQUFBLEdBQWEsR0FBYixHQUFrQixTQUEvQixDQUFBLENBQUE7V0FDQSxNQUFNLENBQUMsSUFBUCxDQUFZLEdBQVosRUFBaUIsU0FBQyxHQUFELEdBQUE7YUFDZixNQUFNLENBQUMsS0FBUCxDQUFhLEdBQWIsRUFEZTtJQUFBLENBQWpCLEVBRmM7RUFBQSxDQUFoQixFQUhZO0FBQUEsQ0E5Q2QsQ0FBQTs7QUFBQSxXQXNEQSxHQUFjLFNBQUEsR0FBQTtBQUNaLE1BQUEsT0FBQTtTQUFBLE9BQUEsR0FDRTtBQUFBLElBQUEsSUFBQSxFQUFNLElBQUksQ0FBQyxRQUFMLENBQWMsR0FBZCxDQUFOO0lBRlU7QUFBQSxDQXREZCxDQUFBOztBQUFBLFNBMERBLEdBQVksU0FBQyxLQUFELEdBQUE7QUFDVixNQUFBLG9GQUFBOztJQURXLFFBQVE7R0FDbkI7QUFBQSxFQUFBLFNBQUEsR0FBWSxLQUFBLEtBQVMsUUFBckIsQ0FBQTtBQUFBLEVBQ0EsT0FBQSxHQUFVLFdBQUEsQ0FBQSxDQURWLENBQUE7QUFBQSxFQUVBLEdBQUEsR0FBUyxTQUFILEdBQWtCLFFBQWxCLEdBQWdDLElBRnRDLENBQUE7QUFBQSxFQUdBLEtBQUEsR0FBUSxDQUFDLFlBQUQsRUFBZ0IsZ0JBQUEsR0FBZSxHQUEvQixDQUhSLENBQUE7QUFBQSxFQUlBLFFBQUEsR0FBVyxDQUFBLENBQUUsS0FBRixDQUNULENBQUMsR0FEUSxDQUNKLFNBQUMsQ0FBRCxHQUFBO1dBQU8sa0JBQUEsQ0FBb0IsMkJBQUEsR0FBMEIsQ0FBOUMsRUFBUDtFQUFBLENBREksQ0FFVCxDQUFDLEdBRlEsQ0FFSixTQUFDLENBQUQsR0FBQTtXQUFPLEtBQUssQ0FBQyxNQUFOLENBQWEsQ0FBYixFQUFnQixPQUFoQixFQUFQO0VBQUEsQ0FGSSxDQUdULENBQUMsR0FIUSxDQUdKLFNBQUMsQ0FBRCxHQUFBO1dBQU8sQ0FBQyxDQUFDLElBQUYsQ0FBQSxFQUFQO0VBQUEsQ0FISSxDQUlULENBQUMsS0FKUSxDQUFBLENBSlgsQ0FBQTtBQUFBLEVBU0EsZ0JBQUEsR0FBbUIsQ0FBQyxDQUFDLEdBQUYsQ0FBTSxLQUFOLEVBQWEsUUFBYixDQVRuQixDQUFBO0FBV0E7T0FBQSx1REFBQTtnQ0FBQTtBQUFBLGtCQUFBLFlBQUEsQ0FBYSxJQUFiLEVBQUEsQ0FBQTtBQUFBO2tCQVpVO0FBQUEsQ0ExRFosQ0FBQTs7QUFBQSxZQXdFQSxHQUFlLFNBQUMsSUFBRCxHQUFBO0FBQ2IsTUFBQSxrQkFBQTtBQUFBLEVBQUMsa0JBQUQsRUFBVyxrQkFBWCxDQUFBO0FBQ0EsRUFBQSxJQUFBLENBQUEsRUFBUyxDQUFDLFVBQUgsQ0FBYyxRQUFkLENBQVA7QUFDRSxJQUFBLE1BQU0sQ0FBQyxJQUFQLENBQWEsV0FBQSxHQUFVLFFBQXZCLENBQUEsQ0FBQTtXQUNBLEVBQUUsQ0FBQyxhQUFILENBQWlCLFFBQWpCLEVBQTJCLFFBQTNCLEVBRkY7R0FGYTtBQUFBLENBeEVmLENBQUE7O0FBQUEsUUE4RUEsR0FBVyxTQUFDLFFBQUQsR0FBQTtBQUNULE1BQUEsZ0JBQUE7QUFBQSxFQUFBLFFBQUEsR0FBVyxFQUFFLENBQUMsWUFBSCxDQUFnQixRQUFoQixDQUFYLENBQUE7QUFBQSxFQUNBLE1BQUEsR0FBUyxFQURULENBQUE7QUFBQSxFQUVBLFdBQUEsQ0FBWSxRQUFaLEVBQXNCLFNBQUMsR0FBRCxFQUFNLE1BQU4sR0FBQTtXQUNwQixNQUFBLEdBQVMsT0FEVztFQUFBLENBQXRCLENBRkEsQ0FBQTtTQUlBLE9BTFM7QUFBQSxDQTlFWCxDQUFBOztBQUFBLE1BcUZNLENBQUMsT0FBUCxHQUFpQjtBQUFBLEVBQUMsY0FBQSxZQUFEO0FBQUEsRUFBZSxhQUFBLFdBQWY7QUFBQSxFQUE0QixpQkFBQSxlQUE1QjtDQXJGakIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiXHJcblxyXG5mcyA9IHJlcXVpcmUgJ2ZzJ1xyXG5wYXRoID0gcmVxdWlyZSAncGF0aCdcclxud2F0Y2ggPSByZXF1aXJlICdjaG9raWRhcidcclxud3JlbmNoID0gcmVxdWlyZSAnd3JlbmNoJ1xyXG5sb2dnZXIgPSByZXF1aXJlICdsb2dtaW1vc2EnXHJcbl8gPSByZXF1aXJlICdsb2Rhc2gnXHJcbm1rZGlycCA9IHJlcXVpcmUgJ21rZGlycCdcclxucGFyc2VTdHJpbmcgPSByZXF1aXJlKCd4bWwyanMnKS5wYXJzZVN0cmluZ1xyXG5CbGlzcyA9IHJlcXVpcmUgJ2JsaXNzJ1xyXG5ibGlzcyA9IG5ldyBCbGlzc1xyXG4gIGV4dDogXCIuYmxpc3NcIlxyXG4gIGNhY2hlRW5hYmxlZDogZmFsc2UsXHJcbiAgY29udGV4dDoge31cclxuY3dkID0gcHJvY2Vzcy5jd2QoKVxyXG5cclxuaW1wb3J0QXNzZXRzID0gKG1pbW9zYUNvbmZpZywgb3B0aW9ucywgbmV4dCkgLT5cclxuICBleHRlbnNpb25zID0gbWltb3NhQ29uZmlnLmV4dGVuc2lvbnMuY29weVxyXG4gIHNvdXJjZUZpbGVzID0gZmluZFNvdXJjZUZpbGVzIGV4dGVuc2lvbnNcclxuICBsb2dnZXIuaW5mbyBzb3VyY2VGaWxlc1xyXG4gICNUT0RPOiBnYXRoZXIgc291cmNlc1xyXG4gICMubGlua3MsIHdpbGwgdXNlIHBhcnNlWG1sIGZvciB0aGlzXHJcbiAgI2Z1YnUtY29udGVudFxyXG4gICNzb3VyY2UgZGlyIChpbmNsdWRpbmcgY29udGVudClcclxuICBuZXh0KClcclxuXHJcbmNsZWFuQXNzZXRzID0gKG1pbW9zYUNvbmZpZywgb3B0aW9ucywgbmV4dCkgLT5cclxuICBuZXh0KClcclxuXHJcbmZpbmRTb3VyY2VGaWxlcyA9IChleHRlbnNpb25zKSAtPlxyXG4gIGV4dGVuc2lvbnMgPSBleHRlbnNpb25zLm1hcCAoZXh0KSAtPiBcIi4je2V4dH1cIlxyXG4gIHdyZW5jaC5yZWFkZGlyU3luY1JlY3Vyc2l2ZShjd2QpXHJcbiAgICAuZmlsdGVyIChmKSAtPlxyXG4gICAgICBtYXRjaGVzRXh0ZW5zaW9uID0gXy5jb250YWlucyBleHRlbnNpb25zLCBwYXRoLmV4dG5hbWUgZlxyXG4gICAgICBpc0ZpbGUgPSBmcy5zdGF0U3luYyhmKS5pc0ZpbGUoKVxyXG4gICAgICBtYXRjaGVzRXh0ZW5zaW9uIGFuZCBpc0ZpbGVcclxuXHJcbnJlbGF0aXZlVG9UaGlzRmlsZSA9IChmaWxlUGF0aCwgZGlybmFtZSkgLT5cclxuICBkaXJuYW1lID89IF9fZGlybmFtZVxyXG4gIHBhdGguam9pbiBkaXJuYW1lLCBmaWxlUGF0aFxyXG5cclxuc2V0dXBGaWxlU3lzdGVtID0gKGFyZ3MpIC0+XHJcbiAgbWFrZUZvbGRlcnMoKVxyXG4gIGluaXRGaWxlcyhhcmdzKVxyXG5cclxubWFrZUZvbGRlcnMgPSAtPlxyXG4gICNUT0RPOiByZWFkIHRoaXMgZnJvbSBjb25maWcgc2V0dGluZ3MgaW5zdGVhZCBvZiBoYXJkIGNvZGluZyB0aGlzXHJcbiAgZm9sZGVycyA9IFsnYXNzZXRzL3NjcmlwdHMnLCAnYXNzZXRzL3N0eWxlcycsICdwdWJsaWMnXVxyXG4gIF8uZWFjaCBmb2xkZXJzLCAoZGlyKSAtPlxyXG4gICAgbG9nZ2VyLmluZm8gXCJtYWtpbmcgc3VyZSAje2Rpcn0gZXhpc3RzXCJcclxuICAgIG1rZGlycC5zeW5jIGRpciwgKGVycikgLT5cclxuICAgICAgbG9nZ2VyLmVycm9yKGVycilcclxuXHJcbm1ha2VPcHRpb25zID0gLT5cclxuICBvcHRpb25zID1cclxuICAgIG5hbWU6IHBhdGguYmFzZW5hbWUgY3dkXHJcblxyXG5pbml0RmlsZXMgPSAoZmxhZ3MgPSBmYWxzZSkgLT5cclxuICB1c2VDb2ZmZWUgPSBmbGFncyA9PSBcImNvZmZlZVwiXHJcbiAgb3B0aW9ucyA9IG1ha2VPcHRpb25zKClcclxuICBleHQgPSBpZiB1c2VDb2ZmZWUgdGhlbiBcImNvZmZlZVwiIGVsc2UgXCJqc1wiXHJcbiAgZmlsZXMgPSBbXCJib3dlci5qc29uXCIsIFwibWltb3NhLWNvbmZpZy4je2V4dH1cIl1cclxuICBjb250ZW50cyA9IF8gZmlsZXNcclxuICAgIC5tYXAgKGYpIC0+IHJlbGF0aXZlVG9UaGlzRmlsZSBcIi4uL2Z1YnUtaW1wb3J0LXRlbXBsYXRlcy8je2Z9XCJcclxuICAgIC5tYXAgKGYpIC0+IGJsaXNzLnJlbmRlciBmLCBvcHRpb25zXHJcbiAgICAubWFwIChmKSAtPiBmLnRyaW0oKVxyXG4gICAgLnZhbHVlKClcclxuICBmaWxlV2l0aENvbnRlbnRzID0gXy56aXAoZmlsZXMsIGNvbnRlbnRzKVxyXG5cclxuICBjb3B5Q29udGVudHMgcGFpciBmb3IgcGFpciBpbiBmaWxlV2l0aENvbnRlbnRzXHJcblxyXG5jb3B5Q29udGVudHMgPSAocGFpcikgLT5cclxuICBbZmlsZU5hbWUsIGNvbnRlbnRzXSA9IHBhaXJcclxuICB1bmxlc3MgZnMuZXhpc3RzU3luYyBmaWxlTmFtZVxyXG4gICAgbG9nZ2VyLmluZm8gXCJjcmVhdGluZyAje2ZpbGVOYW1lfVwiXHJcbiAgICBmcy53cml0ZUZpbGVTeW5jIGZpbGVOYW1lLCBjb250ZW50c1xyXG5cclxucGFyc2VYbWwgPSAoZmlsZVBhdGgpIC0+XHJcbiAgY29udGVudHMgPSBmcy5yZWFkRmlsZVN5bmMgZmlsZVBhdGhcclxuICByZXN1bHQgPSB7fVxyXG4gIHBhcnNlU3RyaW5nIGNvbnRlbnRzLCAoZXJyLCBvdXRwdXQpIC0+XHJcbiAgICByZXN1bHQgPSBvdXRwdXRcclxuICByZXN1bHRcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge2ltcG9ydEFzc2V0cywgY2xlYW5Bc3NldHMsIHNldHVwRmlsZVN5c3RlbX1cclxuIl19
