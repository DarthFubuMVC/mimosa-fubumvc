"use strict";
var Bliss, Rx, bliss, cleanAssets, copyContents, cwd, excludeStrategies, findSourceFiles, fs, importAssets, initFiles, isExcluded, logger, makeFolders, makeOptions, mkdirp, parseString, parseXml, path, relativeToThisFile, setupFileSystem, startCopying, watch, wrench, _;

fs = require('fs');

path = require('path');

watch = require('chokidar');

wrench = require('wrench');

logger = require('logmimosa');

_ = require('lodash');

mkdirp = require('mkdirp');

parseString = require('xml2js').parseString;

Bliss = require('bliss');

bliss = new Bliss({
  ext: ".bliss",
  cacheEnabled: false,
  context: {}
});

cwd = process.cwd();

Rx = require("rx");

importAssets = function(mimosaConfig, options, next) {
  var excludes, extensions, sourceFiles;
  extensions = mimosaConfig.extensions.copy;
  excludes = mimosaConfig.fubumvc.excludePaths;
  sourceFiles = findSourceFiles(extensions, excludes);
  logger.info(sourceFiles);
  return next();
};

cleanAssets = function(mimosaConfig, options, next) {
  return next();
};

findSourceFiles = function(extensions, excludes) {
  extensions = extensions.map(function(ext) {
    return "." + ext;
  });
  return wrench.readdirSyncRecursive(cwd).filter(function(f) {
    var atRoot, excluded, isFile, matchesExtension;
    atRoot = f.indexOf(path.sep) === -1;
    matchesExtension = _.contains(extensions, path.extname(f));
    isFile = fs.statSync(f).isFile();
    excluded = isExcluded(f, excludes);
    return matchesExtension && isFile && !excluded && !atRoot;
  });
};

startCopying = function(from, cb) {
  var adds, changes, errors, excludes, filesToCopy, filesToDelete, scrub, unlinks, watchSettings, watcher;
  excludes = ["test.txt"];
  watchSettings = {
    ignored: function(f) {
      return isExcluded(f, excludes);
    },
    persistent: false,
    usePolling: true,
    interval: 500,
    binaryInterval: 1000
  };
  watcher = watch.watch(from, watchSettings);
  adds = Rx.Observable.fromEvent(watcher, "add");
  changes = Rx.Observable.fromEvent(watcher, "change");
  unlinks = Rx.Observable.fromEvent(watcher, "unlink");
  errors = (Rx.Observable.fromEvent(watcher, "error")).map(function(e) {
    return Rx.Observable.Throw(e);
  });
  console.log(from);
  scrub = function(input) {
    return input.replace(from, '');
  };
  filesToCopy = adds.merge(changes).merge(errors).map(scrub);
  filesToCopy.subscribe(function(f) {
    console.log("added " + f);
    return cb();
  }, function(e) {
    return console.log("error " + e.message);
  });
  filesToDelete = unlinks.merge(errors).map(function(f) {
    return path.basename(f);
  });
  watcher.on("change", function(f) {
    return console.log("changed " + f);
  });
  watcher.on("unlink", function(f) {
    return console.log("unlinked " + f);
  });
  return watcher.on("error", function(error) {
    return console.log("error " + error);
  });
};

excludeStrategies = {
  string: {
    identity: _.isString,
    predicate: function(ex, path) {
      return path.indexOf(ex) === 0;
    }
  },
  regex: {
    identity: _.isRegExp,
    predicate: function(ex, path) {
      return ex.test(path);
    }
  }
};

isExcluded = function(path, excludes) {
  var ofType;
  ofType = function(method) {
    return excludes.filter(function(f) {
      return method(f);
    });
  };
  return _.any(excludeStrategies, function(_arg) {
    var identity, predicate;
    identity = _arg.identity, predicate = _arg.predicate;
    return _.any(ofType(identity), function(ex) {
      return predicate(ex, path);
    });
  });
};

relativeToThisFile = function(filePath, dirname) {
  if (dirname == null) {
    dirname = __dirname;
  }
  return path.join(dirname, filePath);
};

setupFileSystem = function(args) {
  makeFolders();
  return initFiles(args);
};

makeFolders = function() {
  var folders;
  folders = ['assets/scripts', 'assets/styles', 'public'];
  return _.each(folders, function(dir) {
    logger.info("making sure " + dir + " exists");
    return mkdirp.sync(dir, function(err) {
      return logger.error(err);
    });
  });
};

makeOptions = function() {
  var options;
  return options = {
    name: path.basename(cwd)
  };
};

initFiles = function(flags) {
  var contents, ext, fileWithContents, files, options, pair, useCoffee, _i, _len;
  if (flags == null) {
    flags = false;
  }
  useCoffee = flags === "coffee";
  options = makeOptions();
  ext = useCoffee ? "coffee" : "js";
  files = ["bower.json", "mimosa-config." + ext];
  contents = _(files).map(function(f) {
    return relativeToThisFile("../fubu-import-templates/" + f);
  }).map(function(f) {
    return bliss.render(f, options);
  }).map(function(f) {
    return f.trim();
  }).value();
  fileWithContents = _.zip(files, contents);
  for (_i = 0, _len = fileWithContents.length; _i < _len; _i++) {
    pair = fileWithContents[_i];
    copyContents(pair);
  }
};

copyContents = function(_arg) {
  var contents, fileName;
  fileName = _arg[0], contents = _arg[1];
  if (!fs.existsSync(fileName)) {
    logger.info("creating " + fileName);
    return fs.writeFileSync(fileName, contents);
  }
};

parseXml = function(filePath) {
  var contents, result;
  contents = fs.readFileSync(filePath);
  result = {};
  parseString(contents, function(err, output) {
    return result = output;
  });
  return result;
};

module.exports = {
  importAssets: importAssets,
  cleanAssets: cleanAssets,
  setupFileSystem: setupFileSystem
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYzpcXEhvbWVcXGdpdGh1YlxcbWltb3NhLWZ1YnVtdmNcXGxpYlxcZnVidS1pbXBvcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjOlxcSG9tZVxcZ2l0aHViXFxtaW1vc2EtZnVidW12Y1xcc3JjXFxmdWJ1LWltcG9ydC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBQSxDQUFBO0FBQUEsSUFBQSx5UUFBQTs7QUFBQSxFQUVBLEdBQUssT0FBQSxDQUFRLElBQVIsQ0FGTCxDQUFBOztBQUFBLElBR0EsR0FBTyxPQUFBLENBQVEsTUFBUixDQUhQLENBQUE7O0FBQUEsS0FJQSxHQUFRLE9BQUEsQ0FBUSxVQUFSLENBSlIsQ0FBQTs7QUFBQSxNQUtBLEdBQVMsT0FBQSxDQUFRLFFBQVIsQ0FMVCxDQUFBOztBQUFBLE1BTUEsR0FBUyxPQUFBLENBQVEsV0FBUixDQU5ULENBQUE7O0FBQUEsQ0FPQSxHQUFJLE9BQUEsQ0FBUSxRQUFSLENBUEosQ0FBQTs7QUFBQSxNQVFBLEdBQVMsT0FBQSxDQUFRLFFBQVIsQ0FSVCxDQUFBOztBQUFBLFdBU0EsR0FBYyxPQUFBLENBQVEsUUFBUixDQUFpQixDQUFDLFdBVGhDLENBQUE7O0FBQUEsS0FVQSxHQUFRLE9BQUEsQ0FBUSxPQUFSLENBVlIsQ0FBQTs7QUFBQSxLQVdBLEdBQVksSUFBQSxLQUFBLENBQ1Y7QUFBQSxFQUFBLEdBQUEsRUFBSyxRQUFMO0FBQUEsRUFDQSxZQUFBLEVBQWMsS0FEZDtBQUFBLEVBRUEsT0FBQSxFQUFTLEVBRlQ7Q0FEVSxDQVhaLENBQUE7O0FBQUEsR0FlQSxHQUFNLE9BQU8sQ0FBQyxHQUFSLENBQUEsQ0FmTixDQUFBOztBQUFBLEVBZ0JBLEdBQUssT0FBQSxDQUFRLElBQVIsQ0FoQkwsQ0FBQTs7QUFBQSxZQWtCQSxHQUFlLFNBQUMsWUFBRCxFQUFlLE9BQWYsRUFBd0IsSUFBeEIsR0FBQTtBQUNiLE1BQUEsaUNBQUE7QUFBQSxFQUFBLFVBQUEsR0FBYSxZ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QUFNLE1BQU4sR0FBQTtXQUNwQixNQUFBLEdBQVMsT0FEVztFQUFBLENBQXRCLENBRkEsQ0FBQTtTQUlBLE9BTFM7QUFBQSxDQXpJWCxDQUFBOztBQUFBLE1BZ0pNLENBQUMsT0FBUCxHQUFpQjtBQUFBLEVBQUMsY0FBQSxZQUFEO0FBQUEsRUFBZSxhQUFBLFdBQWY7QUFBQSxFQUE0QixpQkFBQSxlQUE1QjtDQWhKakIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiXHJcblxyXG5mcyA9IHJlcXVpcmUgJ2ZzJ1xyXG5wYXRoID0gcmVxdWlyZSAncGF0aCdcclxud2F0Y2ggPSByZXF1aXJlICdjaG9raWRhcidcclxud3JlbmNoID0gcmVxdWlyZSAnd3JlbmNoJ1xyXG5sb2dnZXIgPSByZXF1aXJlICdsb2dtaW1vc2EnXHJcbl8gPSByZXF1aXJlICdsb2Rhc2gnXHJcbm1rZGlycCA9IHJlcXVpcmUgJ21rZGlycCdcclxucGFyc2VTdHJpbmcgPSByZXF1aXJlKCd4bWwyanMnKS5wYXJzZVN0cmluZ1xyXG5CbGlzcyA9IHJlcXVpcmUgJ2JsaXNzJ1xyXG5ibGlzcyA9IG5ldyBCbGlzc1xyXG4gIGV4dDogXCIuYmxpc3NcIlxyXG4gIGNhY2hlRW5hYmxlZDogZmFsc2UsXHJcbiAgY29udGV4dDoge31cclxuY3dkID0gcHJvY2Vzcy5jd2QoKVxyXG5SeCA9IHJlcXVpcmUgXCJyeFwiXHJcblxyXG5pbXBvcnRBc3NldHMgPSAobWltb3NhQ29uZmlnLCBvcHRpb25zLCBuZXh0KSAtPlxyXG4gIGV4dGVuc2lvbnMgPSBtaW1vc2FDb25maWcuZXh0ZW5zaW9ucy5jb3B5XHJcbiAgZXhjbHVkZXMgPSBtaW1vc2FDb25maWcuZnVidW12Yy5leGNsdWRlUGF0aHNcclxuICBzb3VyY2VGaWxlcyA9IGZpbmRTb3VyY2VGaWxlcyBleHRlbnNpb25zLCBleGNsdWRlc1xyXG4gIGxvZ2dlci5pbmZvIHNvdXJjZUZpbGVzXHJcbiAgI1RPRE86IGdhdGhlciBzb3VyY2VzXHJcbiAgIy5saW5rcywgd2lsbCB1c2UgcGFyc2VYbWwgZm9yIHRoaXNcclxuICAjZnVidS1jb250ZW50XHJcbiAgI3NvdXJjZSBkaXIgKGluY2x1ZGluZyBjb250ZW50KVxyXG4gIG5leHQoKVxyXG5cclxuY2xlYW5Bc3NldHMgPSAobWltb3NhQ29uZmlnLCBvcHRpb25zLCBuZXh0KSAtPlxyXG4gIG5leHQoKVxyXG5cclxuZmluZFNvdXJjZUZpbGVzID0gKGV4dGVuc2lvbnMsIGV4Y2x1ZGVzKSAtPlxyXG4gIGV4dGVuc2lvbnMgPSBleHRlbnNpb25zLm1hcCAoZXh0KSAtPiBcIi4je2V4dH1cIlxyXG4gIHdyZW5jaC5yZWFkZGlyU3luY1JlY3Vyc2l2ZShjd2QpXHJcbiAgICAuZmlsdGVyIChmKSAtPlxyXG4gICAgICBhdFJvb3QgPSBmLmluZGV4T2YocGF0aC5zZXApID09IC0xXHJcbiAgICAgIG1hdGNoZXNFeHRlbnNpb24gPSBfLmNvbnRhaW5zIGV4dGVuc2lvbnMsIHBhdGguZXh0bmFtZSBmXHJcbiAgICAgIGlzRmlsZSA9IGZzLnN0YXRTeW5jKGYpLmlzRmlsZSgpXHJcbiAgICAgIGV4Y2x1ZGVkID0gaXNFeGNsdWRlZCBmLCBleGNsdWRlc1xyXG4gICAgICBtYXRjaGVzRXh0ZW5zaW9uIGFuZCBpc0ZpbGUgYW5kIG5vdCBleGNsdWRlZCBhbmQgbm90IGF0Um9vdFxyXG5cclxuc3RhcnRDb3B5aW5nID0gKGZyb20sIGNiKSAtPlxyXG4gICNleGNsdWRlOiBbL1svXFxcXF0oXFwufH4pW14vXFxcXF0rJC9dICAgIyByZWdleGVzIG9yIHN0cmluZ3MgbWF0Y2hpbmcgdGhlIGZpbGVzIHRvIGJlXHJcbiAgZXhjbHVkZXMgPSBbXCJ0ZXN0LnR4dFwiXVxyXG4gIHdhdGNoU2V0dGluZ3MgPVxyXG4gICAgaWdub3JlZDogKGYpIC0+IGlzRXhjbHVkZWQgZiwgZXhjbHVkZXNcclxuICAgIHBlcnNpc3RlbnQ6IGZhbHNlXHJcbiAgICB1c2VQb2xsaW5nOiB0cnVlXHJcbiAgICBpbnRlcnZhbDogNTAwXHJcbiAgICBiaW5hcnlJbnRlcnZhbDogMTAwMFxyXG4gIHdhdGNoZXIgPSB3YXRjaC53YXRjaCBmcm9tLCB3YXRjaFNldHRpbmdzXHJcblxyXG4gIGFkZHMgPSBSeC5PYnNlcnZhYmxlLmZyb21FdmVudCB3YXRjaGVyLCBcImFkZFwiXHJcbiAgY2hhbmdlcyA9IFJ4Lk9ic2VydmFibGUuZnJvbUV2ZW50IHdhdGNoZXIsIFwiY2hhbmdlXCJcclxuICB1bmxpbmtzID0gUnguT2JzZXJ2YWJsZS5mcm9tRXZlbnQgd2F0Y2hlciwgXCJ1bmxpbmtcIlxyXG4gIGVycm9ycyA9IChSeC5PYnNlcnZhYmxlLmZyb21FdmVudCB3YXRjaGVyLCBcImVycm9yXCIpLm1hcCAoZSkgLT4gUnguT2JzZXJ2YWJsZS5UaHJvdyBlXHJcblxyXG4gIGNvbnNvbGUubG9nIGZyb21cclxuXHJcbiAgc2NydWIgPSAoaW5wdXQpIC0+XHJcbiAgICBpbnB1dC5yZXBsYWNlIGZyb20sICcnXHJcblxyXG4gIGZpbGVzVG9Db3B5ID0gYWRkc1xyXG4gICAgLm1lcmdlKGNoYW5nZXMpXHJcbiAgICAubWVyZ2UoZXJyb3JzKVxyXG4gICAgLm1hcCBzY3J1YlxyXG5cclxuICBmaWxlc1RvQ29weS5zdWJzY3JpYmUgXFxcclxuICAgIChmKSAtPiBjb25zb2xlLmxvZyBcImFkZGVkICN7Zn1cIjsgY2IoKSxcclxuICAgIChlKSAtPiBjb25zb2xlLmxvZyBcImVycm9yICN7ZS5tZXNzYWdlfVwiXHJcblxyXG4gIGZpbGVzVG9EZWxldGUgPSB1bmxpbmtzXHJcbiAgICAubWVyZ2UoZXJyb3JzKVxyXG4gICAgLm1hcCAoZikgLT4gcGF0aC5iYXNlbmFtZSBmXHJcblxyXG4gIHdhdGNoZXIub24gXCJjaGFuZ2VcIiwgKGYpIC0+IGNvbnNvbGUubG9nIFwiY2hhbmdlZCAje2Z9XCJcclxuICB3YXRjaGVyLm9uIFwidW5saW5rXCIsIChmKSAtPiBjb25zb2xlLmxvZyBcInVubGlua2VkICN7Zn1cIlxyXG4gICN3YXRjaGVyLm9uIFwiYWRkXCIsIChmKSAtPiBjb25zb2xlLmxvZyBcImFkZGVkICN7Zn1cIjsgY2IoKVxyXG4gIHdhdGNoZXIub24gXCJlcnJvclwiLCAoZXJyb3IpIC0+IGNvbnNvbGUubG9nIFwiZXJyb3IgI3tlcnJvcn1cIlxyXG5cclxuZXhjbHVkZVN0cmF0ZWdpZXMgPVxyXG4gIHN0cmluZzpcclxuICAgIGlkZW50aXR5OiBfLmlzU3RyaW5nXHJcbiAgICBwcmVkaWNhdGU6IChleCwgcGF0aCkgLT4gcGF0aC5pbmRleE9mKGV4KSA9PSAwXHJcbiAgcmVnZXg6XHJcbiAgICBpZGVudGl0eTogXy5pc1JlZ0V4cFxyXG4gICAgcHJlZGljYXRlOiAoZXgsIHBhdGgpIC0+IGV4LnRlc3QgcGF0aFxyXG5cclxuaXNFeGNsdWRlZCA9IChwYXRoLCBleGNsdWRlcykgLT5cclxuICBvZlR5cGUgPSAobWV0aG9kKSAtPlxyXG4gICAgZXhjbHVkZXMuZmlsdGVyIChmKSAtPiBtZXRob2QoZilcclxuXHJcbiAgXy5hbnkgZXhjbHVkZVN0cmF0ZWdpZXMsICh7aWRlbnRpdHksIHByZWRpY2F0ZX0pIC0+XHJcbiAgICBfLmFueSAob2ZUeXBlIGlkZW50aXR5KSwgKGV4KSAtPiBwcmVkaWNhdGUgZXgsIHBhdGhcclxuXHJcbnJlbGF0aXZlVG9UaGlzRmlsZSA9IChmaWxlUGF0aCwgZGlybmFtZSkgLT5cclxuICBkaXJuYW1lID89IF9fZGlybmFtZVxyXG4gIHBhdGguam9pbiBkaXJuYW1lLCBmaWxlUGF0aFxyXG5cclxuc2V0dXBGaWxlU3lzdGVtID0gKGFyZ3MpIC0+XHJcbiAgbWFrZUZvbGRlcnMoKVxyXG4gIGluaXRGaWxlcyhhcmdzKVxyXG5cclxubWFrZUZvbGRlcnMgPSAtPlxyXG4gIGZvbGRlcnMgPSBbJ2Fzc2V0cy9zY3JpcHRzJywgJ2Fzc2V0cy9zdHlsZXMnLCAncHVibGljJ11cclxuICBfLmVhY2ggZm9sZGVycywgKGRpcikgLT5cclxuICAgIGxvZ2dlci5pbmZvIFwibWFraW5nIHN1cmUgI3tkaXJ9IGV4aXN0c1wiXHJcbiAgICBta2RpcnAuc3luYyBkaXIsIChlcnIpIC0+XHJcbiAgICAgIGxvZ2dlci5lcnJvcihlcnIpXHJcblxyXG5tYWtlT3B0aW9ucyA9IC0+XHJcbiAgb3B0aW9ucyA9XHJcbiAgICBuYW1lOiBwYXRoLmJhc2VuYW1lIGN3ZFxyXG5cclxuaW5pdEZpbGVzID0gKGZsYWdzID0gZmFsc2UpIC0+XHJcbiAgdXNlQ29mZmVlID0gZmxhZ3MgPT0gXCJjb2ZmZWVcIlxyXG4gIG9wdGlvbnMgPSBtYWtlT3B0aW9ucygpXHJcbiAgZXh0ID0gaWYgdXNlQ29mZmVlIHRoZW4gXCJjb2ZmZWVcIiBlbHNlIFwianNcIlxyXG4gIGZpbGVzID0gW1wiYm93ZXIuanNvblwiLCBcIm1pbW9zYS1jb25maWcuI3tleHR9XCJdXHJcbiAgY29udGVudHMgPSBfIGZpbGVzXHJcbiAgICAubWFwIChmKSAtPiByZWxhdGl2ZVRvVGhpc0ZpbGUgXCIuLi9mdWJ1LWltcG9ydC10ZW1wbGF0ZXMvI3tmfVwiXHJcbiAgICAubWFwIChmKSAtPiBibGlzcy5yZW5kZXIgZiwgb3B0aW9uc1xyXG4gICAgLm1hcCAoZikgLT4gZi50cmltKClcclxuICAgIC52YWx1ZSgpXHJcbiAgZmlsZVdpdGhDb250ZW50cyA9IF8uemlwKGZpbGVzLCBjb250ZW50cylcclxuXHJcbiAgY29weUNvbnRlbnRzIHBhaXIgZm9yIHBhaXIgaW4gZmlsZVdpdGhDb250ZW50c1xyXG4gICNhdm9pZCByZXR1cm5pbmcgYW4gYXJyYXkgb2Ygbm90aGluZyB3aGVuIHVzaW5nIGEgY29tcHJlaGVuc2lvbiBhcyB5b3VyIGxhc3QgbGluZVxyXG4gICNieSB1c2luZyBhbiBleHBsaWNpdCByZXR1cm5cclxuICByZXR1cm5cclxuXHJcbmNvcHlDb250ZW50cyA9IChbZmlsZU5hbWUsIGNvbnRlbnRzXSkgLT5cclxuICB1bmxlc3MgZnMuZXhpc3RzU3luYyBmaWxlTmFtZVxyXG4gICAgbG9nZ2VyLmluZm8gXCJjcmVhdGluZyAje2ZpbGVOYW1lfVwiXHJcbiAgICBmcy53cml0ZUZpbGVTeW5jIGZpbGVOYW1lLCBjb250ZW50c1xyXG5cclxucGFyc2VYbWwgPSAoZmlsZVBhdGgpIC0+XHJcbiAgY29udGVudHMgPSBmcy5yZWFkRmlsZVN5bmMgZmlsZVBhdGhcclxuICByZXN1bHQgPSB7fVxyXG4gIHBhcnNlU3RyaW5nIGNvbnRlbnRzLCAoZXJyLCBvdXRwdXQpIC0+XHJcbiAgICByZXN1bHQgPSBvdXRwdXRcclxuICByZXN1bHRcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge2ltcG9ydEFzc2V0cywgY2xlYW5Bc3NldHMsIHNldHVwRmlsZVN5c3RlbX1cclxuIl19
